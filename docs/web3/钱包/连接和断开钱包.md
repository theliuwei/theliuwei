# 连接和断开钱包

# 目标

本节的目标是学习

●连接断开钱包过程及原理

●连接操作

●安全问题

# 连接断开钱包过程及原理

1.**连接钱包**：

●**选择钱包和 DApp**：用户首先选择一个钱包（如 MetaMask、Trust Wallet 等）和一个希望连接的 DApp。

●**授权请求**：DApp 向用户的钱包发起连接请求。这个请求通常会弹出一个窗口，提示用户授权 DApp 访问其钱包地址和基本信息。

●**用户确认**：用户在钱包界面中查看请求的详细信息，并选择批准或拒绝。如果批准，DApp将获得对用户钱包的访问权限。

●**建立会话**：一旦授权成功，钱包和 DApp 之间建立会话，DApp 可以与钱包进行交互，例如读取钱包地址、发送交易请求等。

2.**断开钱包**：

●**用户操作断开**：用户可以在 DApp 或钱包界面中选择断开连接。这个操作通常有一个显著的断开按钮。

●**自动断开机制**：如果用户长时间不进行钱包和 DApp 的交互，钱包会自动断开连接。这个自动断开机制可以由 DApp 或钱包设置，通常为了增加安全性，避免未经授权的访问。

●**撤销权限**：断开连接后，钱包会撤销 DApp 的访问权限，确保 DApp 无法再与钱包交互。

●**结束会话**：钱包与 DApp 之间的会话结束，DApp 不再能访问用户的钱包信息。用户可以选择清理浏览器缓存和数据，进一步提高安全性。

3.**原理**：

●**修改内容：**用户在热钱包应用中创建交易或操作请求

●**签名：**热钱包使用存储在设备中的私钥直接在在线环境中对交易进行数字签名。

●**广播上链：**签名后的交易直接通过热钱包应用广播到区块链网络上。

*注：1.本文中提到的 DApp 默认指运行在以太坊系列区块链上的智能合项目。 2.上文提到信息都是热钱包，冷钱包细节上会多了离线签名等步骤，最终还是本质上还是想办法把签名后的内容广播上链*

![image](./assets/195db3d3-ab1d-4d82-b29b-6d77d33d709a.webp)

# 连接操作

建立钱包连接之后我们会有两种操作

##  交易

你在区块链上进行需要消耗Gas的操作

●发生ETH

●交换代币

●购买NFT

●设置授权

##  消息

仅使用私钥签署消息，不需要消耗Gas

●向智能合约发送指令

●操作已授权的资产

●仅用于证明身份

Gas 是用于在以太坊区块链上执行交易和智能合约的费用。它的主要目的是限制并补偿以太坊网络中的计算工作量

#  安全问题

MetaMask在其安全提示中提到：“不要在不安全的网络环境中连接钱包，例如公共Wi-Fi。始终保持浏览器和钱包应用的更新，以防止安全漏洞被利用。使用硬件钱包是增加安全性的有效方法。”（来源：MetaMask Support） Ledger的官方文档强调：“连接钱包时，始终使用官方渠道下载和更新钱包软件。对于硬件钱包用户，确保每次交易都在硬件设备上进行物理确认，防止私钥泄露。”（来源：Ledger Security）

以下是我们需要注意的地方：

●**权限滥用**：连接钱包时，如果不仔细检查 DApp 请求的权限，可能会授予 DApp 过多的权限，导致资产风险。

●**钓鱼攻击**：假冒的 DApp 或网站可能会请求连接用户的钱包，从而窃取钱包中的资产。

●**恶意软件**：连接过程中，如果设备感染恶意软件，可能会记录用户的操作和私钥信息，导致资产被盗。

同时，还有一些可能发生的场景譬如：钱包的更新迭代是如何不被植入恶意代码或后门？就像我们现实当中的更新某个软件版本之后产生了不良效果：发现了根本跟我现在的硬件不兼容，或者不理想甚至运行不了，安全这东西，无知者无畏、知者敬畏，许多点是细思极恐的。

因此我建议：不要轻易更新，够用就好，当有必要更新的时候需要多方佐证，如利用社区力量、校验工具

#  小结

通过本节内容，我们了解了钱包连接的的原理，以及钱包连接之后的日常操作，并且知晓了在连接钱包需要注意的安全问题